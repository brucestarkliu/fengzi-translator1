<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å³°å­ç¿»è¯‘å¤§å¸ˆ</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        accent: '#06b6d4',
                        dark: '#1e293b',
                        light: '#f8fafc'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .glass-effect {
                @apply bg-white/70 backdrop-blur-md border border-white/20 shadow-lg;
            }
            .btn-primary {
                @apply bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50;
            }
            .btn-secondary {
                @apply bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-secondary/50;
            }
            .btn-icon {
                @apply flex items-center justify-center w-10 h-10 rounded-full bg-white shadow-md hover:shadow-lg transition-all duration-300 text-primary hover:text-primary/80;
            }
            .text-area {
                @apply w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 resize-none transition-all duration-300;
            }
            .switch-btn {
                @apply flex items-center justify-center w-12 h-12 rounded-full bg-primary text-white shadow-md hover:shadow-lg transition-all duration-300 transform hover:rotate-180;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-4 md:p-8 flex flex-col items-center justify-center">
    <div class="w-full max-w-3xl glass-effect rounded-2xl p-6 md:p-8 mb-8">
        <!-- åº”ç”¨å¤´éƒ¨ -->
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-3">
                <img src="https://p26-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/8093476b0eb54a37bb18a1174cf0b26a.png~tplv-a9rns2rl98-24:720:720.png?rcl=2025121122365658415F15BD50E6F5D627&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1766068617&x-signature=3YRp4sgeR6nsQ7Sc54UzodC6%2BFE%3D" 
                     alt="åº”ç”¨å¤´åƒ" 
                     class="w-12 h-12 rounded-full object-cover border-2 border-primary">
                <h1 class="text-2xl font-bold text-dark">å³°å­ç¿»è¯‘å¤§å¸ˆ</h1>
            </div>
            <div class="flex items-center space-x-2">
                <button id="theme-toggle" class="btn-icon">
                    <i class="fa fa-moon-o"></i>
                </button>
                <button id="fullscreen-toggle" class="btn-icon">
                    <i class="fa fa-expand"></i>
                </button>
            </div>
        </div>

        <!-- ç¿»è¯‘åŒºåŸŸ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- æºè¯­è¨€ -->
            <div class="flex flex-col space-y-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <span id="source-flag" class="text-2xl">ğŸ‡¨ğŸ‡³</span>
                        <select id="source-language" class="bg-white border border-gray-300 text-dark rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                            <option value="zh-CN" selected>ä¸­æ–‡</option>
                            <option value="en-US">è‹±æ–‡</option>
                        </select>
                    </div>
                    <button id="source-voice-input" class="btn-icon" title="è¯­éŸ³è¾“å…¥">
                        <i class="fa fa-microphone"></i>
                    </button>
                </div>
                <textarea id="source-text" class="text-area h-40" placeholder="è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬..."></textarea>
                <div class="flex justify-between items-center">
                    <span id="source-chars" class="text-sm text-gray-500">0 å­—ç¬¦</span>
                    <button id="clear-source" class="text-sm text-gray-500 hover:text-gray-700 transition-colors">
                        <i class="fa fa-trash-o mr-1"></i>æ¸…ç©º
                    </button>
                </div>
            </div>

            <!-- åˆ‡æ¢æŒ‰é’® -->
            <div class="hidden md:flex items-center justify-center">
                <button id="swap-languages" class="switch-btn" title="åˆ‡æ¢è¯­è¨€">
                    <i class="fa fa-exchange"></i>
                </button>
            </div>

            <!-- ç›®æ ‡è¯­è¨€ -->
            <div class="flex flex-col space-y-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <span id="target-flag" class="text-2xl">ğŸ‡ºğŸ‡¸</span>
                        <select id="target-language" class="bg-white border border-gray-300 text-dark rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                            <option value="zh-CN">ä¸­æ–‡</option>
                            <option value="en-US" selected>è‹±æ–‡</option>
                        </select>
                    </div>
                    <button id="target-voice-play" class="btn-icon" title="è¯­éŸ³æ’­æ”¾">
                        <i class="fa fa-volume-up"></i>
                    </button>
                </div>
                <textarea id="target-text" class="text-area h-40 bg-gray-50" placeholder="ç¿»è¯‘ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
                <div class="flex justify-between items-center">
                    <span id="target-chars" class="text-sm text-gray-500">0 å­—ç¬¦</span>
                    <button id="copy-target" class="btn-secondary text-sm py-1 px-3">
                        <i class="fa fa-copy mr-1"></i>å¤åˆ¶
                    </button>
                </div>
            </div>
        </div>

        <!-- ç§»åŠ¨ç«¯åˆ‡æ¢æŒ‰é’® -->
        <div class="flex md:hidden items-center justify-center my-4">
            <button id="swap-languages-mobile" class="switch-btn" title="åˆ‡æ¢è¯­è¨€">
                <i class="fa fa-exchange"></i>
            </button>
        </div>

        <!-- ç¿»è¯‘æŒ‰é’® -->
        <div class="flex justify-center mt-6">
            <button id="translate-btn" class="btn-primary px-8 py-3 text-lg">
                <i class="fa fa-language mr-2"></i>å¼€å§‹ç¿»è¯‘
            </button>
        </div>
    </div>

    <!-- å†å²è®°å½•åŒºåŸŸ -->
    <div class="w-full max-w-3xl glass-effect rounded-2xl p-6 md:p-8">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold text-dark">ç¿»è¯‘å†å²</h2>
            <button id="clear-history" class="text-sm text-gray-500 hover:text-gray-700 transition-colors">
                <i class="fa fa-trash-o mr-1"></i>æ¸…ç©ºå†å²
            </button>
        </div>
        <div id="history-list" class="space-y-3 max-h-60 overflow-y-auto">
            <!-- å†å²è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            <div class="text-center text-gray-500 py-4" id="empty-history">
                æš‚æ— ç¿»è¯‘å†å²
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤º -->
    <div id="notification" class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
        <i class="fa fa-check-circle mr-2"></i>
        <span id="notification-text">æ“ä½œæˆåŠŸ</span>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let recognition = null;
        let isRecording = false;
        let historyRecords = JSON.parse(localStorage.getItem('translationHistory')) || [];

        // DOM å…ƒç´ 
        const sourceText = document.getElementById('source-text');
        const targetText = document.getElementById('target-text');
        const sourceLanguage = document.getElementById('source-language');
        const targetLanguage = document.getElementById('target-language');
        const sourceFlag = document.getElementById('source-flag');
        const targetFlag = document.getElementById('target-flag');
        const translateBtn = document.getElementById('translate-btn');
        const swapLanguagesBtn = document.getElementById('swap-languages');
        const swapLanguagesMobileBtn = document.getElementById('swap-languages-mobile');
        const sourceVoiceInputBtn = document.getElementById('source-voice-input');
        const targetVoicePlayBtn = document.getElementById('target-voice-play');
        const copyTargetBtn = document.getElementById('copy-target');
        const clearSourceBtn = document.getElementById('clear-source');
        const clearHistoryBtn = document.getElementById('clear-history');
        const historyList = document.getElementById('history-list');
        const emptyHistory = document.getElementById('empty-history');
        const sourceChars = document.getElementById('source-chars');
        const targetChars = document.getElementById('target-chars');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        const themeToggle = document.getElementById('theme-toggle');
        const fullscreenToggle = document.getElementById('fullscreen-toggle');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³è¯†åˆ«
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = sourceLanguage.value;

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    sourceText.value = transcript;
                    updateCharCount(sourceText, sourceChars);
                    showNotification('è¯­éŸ³è¾“å…¥å®Œæˆ');
                    stopRecording();
                };

                recognition.onerror = (event) => {
                    console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
                    showNotification('è¯­éŸ³è¾“å…¥å¤±è´¥: ' + event.error, 'error');
                    stopRecording();
                };

                recognition.onend = () => {
                    stopRecording();
                };
            } else {
                sourceVoiceInputBtn.disabled = true;
                sourceVoiceInputBtn.title = 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«';
            }

            // åŠ è½½å†å²è®°å½•
            renderHistory();
            
            // æ›´æ–°å­—ç¬¦è®¡æ•°
            updateCharCount(sourceText, sourceChars);
            updateCharCount(targetText, targetChars);
        });

        // äº‹ä»¶ç›‘å¬
        sourceText.addEventListener('input', () => {
            updateCharCount(sourceText, sourceChars);
        });

        targetText.addEventListener('input', () => {
            updateCharCount(targetText, targetChars);
        });

        sourceLanguage.addEventListener('change', () => {
            updateFlag(sourceLanguage.value, sourceFlag);
            if (recognition) {
                recognition.lang = sourceLanguage.value;
            }
        });

        targetLanguage.addEventListener('change', () => {
            updateFlag(targetLanguage.value, targetFlag);
        });

        translateBtn.addEventListener('click', () => {
            translateText();
        });

        swapLanguagesBtn.addEventListener('click', () => {
            swapLanguages();
        });

        swapLanguagesMobileBtn.addEventListener('click', () => {
            swapLanguages();
        });

        sourceVoiceInputBtn.addEventListener('click', () => {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        });

        targetVoicePlayBtn.addEventListener('click', () => {
            playVoice(targetText.value, targetLanguage.value);
        });

        copyTargetBtn.addEventListener('click', () => {
            copyToClipboard(targetText.value);
        });

        clearSourceBtn.addEventListener('click', () => {
            sourceText.value = '';
            updateCharCount(sourceText, sourceChars);
        });

        clearHistoryBtn.addEventListener('click', () => {
            clearHistory();
        });

        themeToggle.addEventListener('click', () => {
            toggleTheme();
        });

        fullscreenToggle.addEventListener('click', () => {
            toggleFullscreen();
        });

        // æŒ‰ Enter é”®ç¿»è¯‘
        sourceText.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                translateText();
            }
        });

        // å‡½æ•°å®šä¹‰
        async function translateText() {
            const text = sourceText.value.trim();
            if (!text) {
                showNotification('è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬', 'error');
                return;
            }

            const sourceLang = sourceLanguage.value;
            const targetLang = targetLanguage.value;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            translateBtn.disabled = true;
            translateBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>ç¿»è¯‘ä¸­...';

            try {
                // ä½¿ç”¨ Google ç¿»è¯‘ API (å…è´¹ç‰ˆæœ‰è¯·æ±‚é™åˆ¶)
                // å®é™…é¡¹ç›®ä¸­å»ºè®®ä½¿ç”¨ä»˜è´¹ API æˆ–å…¶ä»–å¯é çš„ç¿»è¯‘æœåŠ¡
                const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang.split('-')[0]}&tl=${targetLang.split('-')[0]}&dt=t&q=${encodeURIComponent(text)}`);
                const data = await response.json();
                const translatedText = data[0].map(item => item[0]).join('');

                // æ˜¾ç¤ºç¿»è¯‘ç»“æœ
                targetText.value = translatedText;
                updateCharCount(targetText, targetChars);

                // æ·»åŠ åˆ°å†å²è®°å½•
                addToHistory(text, translatedText, sourceLang, targetLang);

                showNotification('ç¿»è¯‘å®Œæˆ');
            } catch (error) {
                console.error('ç¿»è¯‘é”™è¯¯:', error);
                showNotification('ç¿»è¯‘å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                
                // ä½¿ç”¨ç®€å•çš„æ¨¡æ‹Ÿç¿»è¯‘ï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼‰
                if (sourceLang === 'zh-CN' && targetLang === 'en-US') {
                    targetText.value = 'This is a mock translation result. In a real application, you would integrate with a translation API.';
                } else if (sourceLang === 'en-US' && targetLang === 'zh-CN') {
                    targetText.value = 'è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿç¿»è¯‘ç»“æœã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ‚¨éœ€è¦é›†æˆç¿»è¯‘APIã€‚';
                } else {
                    targetText.value = 'ç¿»è¯‘å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚';
                }
                updateCharCount(targetText, targetChars);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                translateBtn.disabled = false;
                translateBtn.innerHTML = '<i class="fa fa-language mr-2"></i>å¼€å§‹ç¿»è¯‘';
            }
        }

        function swapLanguages() {
            // äº¤æ¢è¯­è¨€é€‰æ‹©
            const tempLang = sourceLanguage.value;
            sourceLanguage.value = targetLanguage.value;
            targetLanguage.value = tempLang;

            // äº¤æ¢æ–‡æœ¬å†…å®¹
            const tempText = sourceText.value;
            sourceText.value = targetText.value;
            targetText.value = tempText;

            // æ›´æ–°å›½æ——
            updateFlag(sourceLanguage.value, sourceFlag);
            updateFlag(targetLanguage.value, targetFlag);

            // æ›´æ–°å­—ç¬¦è®¡æ•°
            updateCharCount(sourceText, sourceChars);
            updateCharCount(targetText, targetChars);

            // æ›´æ–°è¯­éŸ³è¯†åˆ«è¯­è¨€
            if (recognition) {
                recognition.lang = sourceLanguage.value;
            }

            showNotification('è¯­è¨€å·²åˆ‡æ¢');
        }

        function startRecording() {
            if (!recognition) return;

            try {
                recognition.lang = sourceLanguage.value;
                recognition.start();
                isRecording = true;
                sourceVoiceInputBtn.innerHTML = '<i class="fa fa-stop"></i>';
                sourceVoiceInputBtn.classList.add('bg-red-500', 'text-white');
                showNotification('æ­£åœ¨è†å¬...');
            } catch (error) {
                console.error('å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥:', error);
                showNotification('è¯­éŸ³è¾“å…¥å¤±è´¥', 'error');
            }
        }

        function stopRecording() {
            if (!recognition) return;

            recognition.stop();
            isRecording = false;
            sourceVoiceInputBtn.innerHTML = '<i class="fa fa-microphone"></i>';
            sourceVoiceInputBtn.classList.remove('bg-red-500', 'text-white');
        }

        function playVoice(text, lang) {
            if (!text) {
                showNotification('æ²¡æœ‰å¯æ’­æ”¾çš„æ–‡æœ¬', 'error');
                return;
            }

            if ('speechSynthesis' in window) {
                // åœæ­¢ä¹‹å‰çš„è¯­éŸ³
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 1.0;
                utterance.pitch = 1.0;

                utterance.onstart = () => {
                    targetVoicePlayBtn.disabled = true;
                    targetVoicePlayBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i>';
                };

                utterance.onend = () => {
                    targetVoicePlayBtn.disabled = false;
                    targetVoicePlayBtn.innerHTML = '<i class="fa fa-volume-up"></i>';
                };

                utterance.onerror = (event) => {
                    console.error('è¯­éŸ³æ’­æ”¾é”™è¯¯:', event.error);
                    showNotification('è¯­éŸ³æ’­æ”¾å¤±è´¥', 'error');
                    targetVoicePlayBtn.disabled = false;
                    targetVoicePlayBtn.innerHTML = '<i class="fa fa-volume-up"></i>';
                };

                window.speechSynthesis.speak(utterance);
            } else {
                showNotification('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æ’­æ”¾', 'error');
            }
        }

        function copyToClipboard(text) {
            if (!text) {
                showNotification('æ²¡æœ‰å¯å¤åˆ¶çš„æ–‡æœ¬', 'error');
                return;
            }

            // ä¼˜å…ˆä½¿ç”¨ç°ä»£ API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showNotification('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } else {
                    showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            }

            document.body.removeChild(textArea);
        }

        function addToHistory(sourceText, targetText, sourceLang, targetLang) {
            const record = {
                id: Date.now(),
                sourceText,
                targetText,
                sourceLang,
                targetLang,
                timestamp: new Date().toLocaleString()
            };

            historyRecords.unshift(record);
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡
            if (historyRecords.length > 50) {
                historyRecords = historyRecords.slice(0, 50);
            }

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('translationHistory', JSON.stringify(historyRecords));
            
            // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
            renderHistory();
        }

        function renderHistory() {
            if (historyRecords.length === 0) {
                emptyHistory.classList.remove('hidden');
                historyList.classList.add('hidden');
                return;
            }

            emptyHistory.classList.add('hidden');
            historyList.classList.remove('hidden');
            
            historyList.innerHTML = '';
            
            historyRecords.forEach(record => {
                const sourceLangName = getLanguageName(record.sourceLang);
                const targetLangName = getLanguageName(record.targetLang);
                const sourceFlagEmoji = getFlagEmoji(record.sourceLang);
                const targetFlagEmoji = getFlagEmoji(record.targetLang);

                const historyItem = document.createElement('div');
                historyItem.className = 'p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer';
                historyItem.innerHTML = `
                    <div class="flex items-center justify-between text-xs text-gray-500 mb-1">
                        <span>${record.timestamp}</span>
                        <span>${sourceLangName} â†’ ${targetLangName}</span>
                    </div>
                    <div class="flex items-start space-x-2">
                        <div class="flex flex-col w-[48%]">
                            <div class="flex items-center text-xs mb-1">
                                <span class="mr-1">${sourceFlagEmoji}</span>
                                <span>${sourceLangName}</span>
                            </div>
                            <p class="text-sm truncate">${record.sourceText}</p>
                        </div>
                        <div class="flex-shrink-0 text-gray-400">
                            <i class="fa fa-long-arrow-right"></i>
                        </div>
                        <div class="flex flex-col w-[48%]">
                            <div class="flex items-center text-xs mb-1">
                                <span class="mr-1">${targetFlagEmoji}</span>
                                <span>${targetLangName}</span>
                            </div>
                            <p class="text-sm truncate">${record.targetText}</p>
                        </div>
                    </div>
                `;

                historyItem.addEventListener('click', () => {
                    // ç‚¹å‡»å†å²è®°å½•æ—¶å¡«å……åˆ°è¾“å…¥æ¡†
                    sourceText.value = record.sourceText;
                    targetText.value = record.targetText;
                    sourceLanguage.value = record.sourceLang;
                    targetLanguage.value = record.targetLang;
                    updateFlag(record.sourceLang, sourceFlag);
                    updateFlag(record.targetLang, targetFlag);
                    updateCharCount(sourceText, sourceChars);
                    updateCharCount(targetText, targetChars);
                    
                    // æ›´æ–°è¯­éŸ³è¯†åˆ«è¯­è¨€
                    if (recognition) {
                        recognition.lang = record.sourceLang;
                    }
                    
                    showNotification('å·²åŠ è½½å†å²è®°å½•');
                });

                historyList.appendChild(historyItem);
            });
        }

        function clearHistory() {
            if (historyRecords.length === 0) {
                showNotification('å†å²è®°å½•å·²ä¸ºç©º', 'error');
                return;
            }

            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç¿»è¯‘å†å²å—ï¼Ÿ')) {
                historyRecords = [];
                localStorage.removeItem('translationHistory');
                renderHistory();
                showNotification('å†å²è®°å½•å·²æ¸…ç©º');
            }
        }

        function updateCharCount(textarea, counterElement) {
            const count = textarea.value.length;
            counterElement.textContent = `${count} å­—ç¬¦`;
        }

        function updateFlag(langCode, flagElement) {
            flagElement.textContent = getFlagEmoji(langCode);
        }

        function getFlagEmoji(langCode) {
            const flags = {
                'zh-CN': 'ğŸ‡¨ğŸ‡³',
                'en-US': 'ğŸ‡ºğŸ‡¸',
                'en-GB': 'ğŸ‡¬ğŸ‡§',
                'ja-JP': 'ğŸ‡¯ğŸ‡µ',
                'ko-KR': 'ğŸ‡°ğŸ‡·',
                'fr-FR': 'ğŸ‡«ğŸ‡·',
                'de-DE': 'ğŸ‡©ğŸ‡ª',
                'es-ES': 'ğŸ‡ªğŸ‡¸',
                'ru-RU': 'ğŸ‡·ğŸ‡º',
                'ar-SA': 'ğŸ‡¸ğŸ‡¦'
            };
            return flags[langCode] || 'ğŸŒ';
        }

        function getLanguageName(langCode) {
            const languages = {
                'zh-CN': 'ä¸­æ–‡',
                'en-US': 'è‹±æ–‡',
                'en-GB': 'è‹±æ–‡(è‹±å›½)',
                'ja-JP': 'æ—¥è¯­',
                'ko-KR': 'éŸ©è¯­',
                'fr-FR': 'æ³•è¯­',
                'de-DE': 'å¾·è¯­',
                'es-ES': 'è¥¿ç­ç‰™è¯­',
                'ru-RU': 'ä¿„è¯­',
                'ar-SA': 'é˜¿æ‹‰ä¼¯è¯­'
            };
            return languages[langCode] || langCode;
        }

        function showNotification(message, type = 'success') {
            notificationText.textContent = message;
            
            // è®¾ç½®é€šçŸ¥ç±»å‹æ ·å¼
            notification.className = 'fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg transform transition-all duration-300 flex items-center';
            
            if (type === 'success') {
                notification.classList.add('bg-green-500', 'text-white');
                notification.innerHTML = `<i class="fa fa-check-circle mr-2"></i><span id="notification-text">${message}</span>`;
            } else if (type === 'error') {
                notification.classList.add('bg-red-500', 'text-white');
                notification.innerHTML = `<i class="fa fa-exclamation-circle mr-2"></i><span id="notification-text">${message}</span>`;
            } else if (type === 'warning') {
                notification.classList.add('bg-yellow-500', 'text-white');
                notification.innerHTML = `<i class="fa fa-exclamation-triangle mr-2"></i><span id="notification-text">${message}</span>`;
            }
            
            // æ˜¾ç¤ºé€šçŸ¥
            notification.classList.remove('translate-y-20', 'opacity-0');
            
            // 3ç§’åéšè—
            setTimeout(() => {
                notification.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.classList.contains('dark');
            
            if (isDark) {
                body.classList.remove('dark', 'bg-gray-900');
                body.classList.add('bg-gradient-to-br', 'from-blue-50', 'to-cyan-50');
                themeToggle.innerHTML = '<i class="fa fa-moon-o"></i>';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark', 'bg-gray-900');
                body.classList.remove('bg-gradient-to-br', 'from-blue-50', 'to-cyan-50');
                themeToggle.innerHTML = '<i class="fa fa-sun-o"></i>';
                localStorage.setItem('theme', 'dark');
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    showNotification(`å…¨å±æ¨¡å¼é”™è¯¯: ${err.message}`, 'error');
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // ç›‘å¬å…¨å±å˜åŒ–
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                fullscreenToggle.innerHTML = '<i class="fa fa-compress"></i>';
            } else {
                fullscreenToggle.innerHTML = '<i class="fa fa-expand"></i>';
            }
        });

        // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark', 'bg-gray-900');
            document.body.classList.remove('bg-gradient-to-br', 'from-blue-50', 'to-cyan-50');
            themeToggle.innerHTML = '<i class="fa fa-sun-o"></i>';
        }
    </script>
</body>
</html>